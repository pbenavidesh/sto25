---
title: "Ejercicio Regresi贸n"
format:
  revealjs:
    scrollable: true
    incremental: true
    smaller: true
    theme: default
    embed-resources: true
    output-file: ej_pres.html
execute:
  echo: true
  output-location: column-fragment
---

```{r}
#| message: false
#| include: false

library(tidyverse)
library(fpp3)
library(ggtime)
```

# Instrucciones

## Objetivo

1. El ejercicio consiste en realizar un an谩lisis de regresi贸n para la serie que eligieron, con el prop贸sito de **realizar pron贸sticos a 3 a帽os**.

2. Lo primero que deben realizar es un an谩lisis exploratorio de su variable de pron贸stico *(saber qu茅 es, para qu茅 se utiliza, c贸mo se mide, en qu茅 unidades est谩, etc.)*.

---

3. Posteriormente, deben elegir **al menos 8 series predictoras** que consideren que pueden ayudar a pronosticar la variable objetivo.  *(recuerden que las series predictoras deben tener sentido econ贸mico y estar relacionadas con la variable a pronosticar)*. Para esto, pueden apoyarse de la inteligencia artificial para que les sugiera posibles series predictoras:
  
  - Les sugiero utilizar el GPT dise帽ado especialmente para la materia, [**Elendil TA**](https://chatgpt.com/g/g-68e6907c12a48191a07fb0888500a7fa-elendil-ta).
  
  - Ustedes deben cuestionar y validar las sugerencias que les haga la IA. Aqu铆 el papel del analista es fundamental. *(es lo que va a impedir que se queden sin chamba o que sean reemplazados por una IA en el futuro, o que queden como* ぁ*)*.
  
  - Idealmente, las series que van a elegir deben ser series econ贸micas que se puedan descargar desde FRED *(para facilitar su descarga)*.

---

4. Ya que tengan las predictoras, realizar el an谩lisis de regresi贸n completo y evaluar si todas esas predictoras se van a quedar en el modelo final o si se debe quitar alguna.
  - Recuerden evaluar los supuestos del modelo de regresi贸n lineal m煤ltiple.
  
  - Pueden utilizar t茅cnicas de selecci贸n de variables si lo consideran necesario.
  
  - Justifiquen todas sus decisiones y muestren el procedimiento que siguieron.

--- 

5. Finalmente, realicen los tres tipos de pron贸sticos que vimos para regresi贸n a 3 a帽os y eval煤en su desempe帽o utilizando las m茅tricas que consideren adecuadas. Para los pron贸sticos basados en escenarios, definir arbitrariamente 2 escenarios:
  - **Optimista:** El desempe帽o de su variable de pron贸stico mejora (dependiendo la variable que les toc贸, esto podria significar que aumente o disminuya).
  - **Pesimista:** El desempe帽o de su variable de pron贸stico empeora.

:::{.callout-note}
## Sobre los tipos de pron贸stico
La diferencia entre los tipos de pron贸stico es qu茅 se hace con las predictoras (las $x$):

### Ex-post
Es cuando separamos en train/test y se usan los valores reales del test en las $x$ (*No son pron贸sticos reales*).

### Ex-ante
**Se deben pronosticar las predictoras** primero y luego usar esos pron贸sticos para hacer el pron贸stico. (*estos son los 煤nicos pron贸sticos reales*).

### Escenarios
Se definen cuantos escenarios quieran y se eligen arbitrariamente los valores de las $x$, dependiendo lo que se quiera evaluar (*es como si se plantearan 驴qu茅 pasar铆a si...?*).

:::
  
## Formato de entrega

1. Todo el ejercicio debe estar contenido en un documento de **Quarto** `(.qmd)` con formato de salida `revealjs` (presentaci贸n de html) o `pptx`(PowerPoint).

:::{.callout-important appearance="simple"}
En las presentaciones, el c贸digo se oculta por default, si quieren que alg煤n chunk muestre el c贸digo, es necesario agregar la opci贸n `echo: true` al chunk. P. ej.:

```
#| echo: true

1 + 1
```
:::
 
:::{.callout-tip}
## Encabezado YAML para los formatos de salida

### `revealjs`

```
---
format: 
  revealjs:
    scrollable: true
    incremental: true
    theme: default
    embed-resources: true
---
```
- Pueden consultar la documentaci贸n aqu铆: [Revealjs Quarto](https://quarto.org/docs/presentations/revealjs/)

### `pptx`
```
---
format: 
  pptx:
    incremental: true
---
```
- Pueden consultar la documentaci贸n aqu铆: [PowerPoint Quarto](https://quarto.org/docs/presentations/powerpoint.html)
:::

# Datos y c贸digo de muestra

## Descarga de datos

```{r}
series <- c("RSXFSN", "UNRATENSA", "PPIACO", "IPN221114T8N", "PERMITNSA") # <1>

data_raw <- tidyquant::tq_get(
  x    = series,
  get  = "economic.data",
  from = "1960-01-01"                                                     # <2> 
)

data_raw
```

1. El listado de series que queremos descargar
2. Fecha de inicio de las series

::: {.callout-important}
Las series a modelar tienen una periodicidad **mensual**, por lo que es importante asegurarse de que las predictoras que hayan elegido para el an谩lisis tambi茅n tengan la misma periodicidad.
:::

## Transformaci贸n a tsibble

### `tsibble` en formato largo

```{r}
data_tsb_long <- data_raw |> 
  mutate(date = yearmonth(date)) |> 
  as_tsibble(key = symbol, index = date)

data_tsb_long                            #<1>
```

1. La `tsibble` as铆 como la descargamos est谩 en formato **largo *(long)* **. Este formato nos va a ser 煤til para realizar an谩lisis o modelar todas las predictoras **simult谩nemente**, pero no para hacer la regresi贸n.

### `tsibble` en formato ancho

```{r}
data_tsb_wide <- data_tsb_long |> 
  pivot_wider(names_from = symbol, values_from = price) |> #<2>
  relocate(date, RSXFSN)                                   #<3>

data_tsb_wide
```
2. Convertimos la `tsibble` a formato **ancho *(wide)* **, que es el formato que necesitamos para hacer la regresi贸n.
3. Reordenamos las columnas para que la variable de pron贸stico est茅 al principio. Sustituyan `RSXFSN` por la variable que les toc贸 pronosticar.

---

::: {.callout-tip}
## Ejemplo de visualizaci贸n de todas las series

```{r}

data_tsb_long |> 
  autoplot(price) +
  facet_wrap(vars(symbol), scales = "free_y") + 
  theme(legend.position = "none") +
  labs(
    title   = "Series descargadas desde FRED",
    x       = "A帽o",
    y       = "",
    caption = "Fuente: Federal Reserve Economic Data (FRED)"
  )
```
:::

