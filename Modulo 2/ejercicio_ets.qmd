---
title: "Descargar datos de internet con `tidyquant`"
format: html
---

# Datos

```{r}
#| message: false

library(tidyverse)
library(fpp3)
library(tidyquant) #<1>
```

1. Cargamos la librería `tidyquant` que nos permite descargar datos económicos de internet (entre otras cosas).

## Descarga

Vamos a utilizar `tq_get()` para descargar los datos

```{r}
exports <- tq_get(
  x = "EXPMX",           #<1>
  get = "economic.data", #<2>
  from = "1985-01-01",   #<3>
  to = "2023-07-01"      #<4>
)
exports                  #<5>
```

1. El nombre de la(s) serie(s) que queremos descargar. En este caso, las exportaciones de EEUU a México (EXPMX).
2. El tipo de dato y fuente de donde queremos descargarlos. En este caso, datos económicos del **FRED**.
3. Fecha de inicio de los datos.
4. Fecha final de los datos.
5. La tabla resultante es una `tibble`.

La `tibble` resultante tenemos que convertirla a `tsibble` y asegurarnos de que la variable de fecha tiene el formato correcto.

## `tsibble`

```{r}
exports <- exports |> 
  mutate(date = yearmonth(date)) |> #<1>
  as_tsibble(index = date)          #<2>
exports
```

1. Convertimos la variable `date` a formato `yearmonth`.
2. Convertimos la `tibble` a `tsibble`, indicando que la variable de fecha es `date`.

# EDA

```{r}
exports |> 
  autoplot(price)
```

# Ejercicio

1. Realizar un pronóstico a dos años para la serie (de agosto 2023 a julio de 2025).
2. Pueden utilizar cualquier método que hemos visto en clase.
3. Se puede realizar en parejas.
4. Entregar un informe en `Quarto` con el análisis y el pronóstico.
5. La métrica de error a utilizar para calcular la precisión del pronóstico será el **MAE**.
6. Fecha de entrega: 19 de septiembre.

```{r}
exports_train <- exports |> 
  filter_index(. ~ "2021 Jul")
exports_train
```

```{r}
exports_fit <- exports_train |> 
  model(
    media = MEAN(price),
    naive = NAIVE(price),
  )

exports_fc <- exports_fit |>
  forecast(h = "2 years")

exports_fc |> 
  accuracy(exports) |> 
  arrange(MAE)
```

El modelo naive es mejor en este caso. Utilizaré este modelo para el pronóstico final:

```{r}
exports_fit |> 
  select(media) |>        #<1>
  refit(exports) |>       #<2>
  forecast(h = "2 years") #<3>
```

1. Seleccionamos el modelo que queremos utilizar para el pronóstico final.
2. Reajustamos el modelo con todos los datos disponibles.
3. Realizamos el pronóstico a dos años.
